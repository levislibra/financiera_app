<openerp>
  <data>
 
    <!-- financiera.prestamo -->

    <record model="ir.ui.view" id="financiera_prestamo_portal_tree">
      <field name="name">Prestamo</field>
      <field name="model">financiera.prestamo</field>
      <field name="arch" type="xml">
        <tree decoration-muted="state == 'cancelado'" decoration-danger="state in ('solicitado', 'revision', 'autorizado')" decoration-success="state == 'pagado'" decoration-warning="state == 'acreditacion_pendiente'" create="false" edit="false" delete="false">
          <field name="partner_id" invisible="1"/>
          <field name="fecha"/>
          <field name="name"/>
          <field name="monto_solicitado" sum="Total"/>
					<field name="state_portal" />
					<field name="state" invisible="1"/>
          <field name="company_id" groups="base.group_erp_manager"/>
        </tree>
      </field>
    </record>

    <!-- Form Prestamo -->

    <record id="financiera_prestamo_portal_form" model="ir.ui.view">
        <field name="name">prestamo.prestamo.form.portal</field>
        <field name="model">financiera.prestamo</field>
        <field name="arch" type="xml">
            <form string="Prestamo" create="false" edit="false" delete="false">
                <header>
									<field name="state" invisible="1" widget="statusbar"/>
								</header>
								<header>
									<field name="state_portal" widget="statusbar"/>
								</header>
                <sheet>
									<script>
										$(document).ready(function(){
											$('.oe_form_sheet_width').css({
												'width': '80%',
												'height': '97%',
												'border-radius':'6px',
												'background-color': 'gainsboro',
											});
										});
									</script>			
									<header attrs="{'invisible': [('state_portal', '!=', 'simulacion')]}">
										<h3><field name="preaprobado_portal" readonly="1" style="color:Red;"/></h3>
									</header>
									<header attrs="{'invisible': [('state_portal', '!=', 'aceptacion')]}">
										<h3><field name="leyenda_tc" readonly="1" style="color:Blue;"/></h3>
									</header>
                  <group name="requisitos" attrs="{'invisible': [('state_portal', '!=', 'requisitos')]}">
										<group>
											<!-- <div col="2" style="background-color:#c8c8c8;border-radius:20px;padding:10px;"> -->
												<field name="partner_id" invisible="1"/>
												<label string="Cliente" style="font-weight:bold;"/>
												<h3><field name="partner_name" readonly="1"/></h3>
												<!-- <label string="CBU"/> -->
												<field name="app_cbu" readonly="1"/>
											<!-- </div> -->
										</group>
										<group></group>
										<!-- <group name="requiere_tarjeta_debito" string="Tarjeta de Debito" 
											col="1" attrs="{'invisible': [('requiere_tarjeta_debito_pass', '=', True)]}">
											<div style="background-color:#c8c8c8;border-radius:20px;padding:20px;">
												<field name="company_id" invisible="1"/>
												<field name="requiere_tarjeta_debito_pass" invisible="1"/>
												<table>
													<tr>
														<td style="width:20%;">
															<label string="Ultimos 4 digitos" style="font-weight:bold;"/>
															<field name="app_tarjeta_debito_digitos_fin"/>
														</td>
														<td style="width:40%;">
															<label string="Vencimiento" style="font-weight:bold;"/>
															<div>
																<field name="app_tarjeta_debito_vencimiento_month" class="oe_inline"/>
																<field name="app_tarjeta_debito_vencimiento_year" class="oe_inline"/>
															</div>
														</td>
													</tr>
												</table>
											</div>
										</group>
										<group></group> -->
									</group>
									<group col="3" attrs="{'invisible': [('state_portal', '!=', 'simulacion')]}">
										<group string="Monto y cuotas">
											<field name="monto_solicitado" string="Monto" readonly="1" required="1" 
												widget="monetary" options="{'currency_field': 'currency_id'}"/>
											<label for="button_wizard_editar_monto_solicitado_portal"/>
											<button name="button_wizard_editar_monto_solicitado_portal" class="oe_highlight" string="Cambiar monto" type="object"/>
											
											<field name="cuotas_portal" readonly="1"/>
											<label name="button_wizard_seleccionar_plan" string=" "/>
											<button name="button_wizard_seleccionar_plan" class="oe_highlight" string="Cambiar cuotas" type="object" attrs="{'invisible': [('state_portal', '!=', 'simulacion')]}"/>
										</group>
										<group col="1" string="Cuotas" style="background-color:#ffffff;padding:4px;">
											<field name="cuota_ids" invisible="1"/>
											<label string="Primer cuota"/>
											<h2><field name="primer_cuota_portal" widget="monetary" options="{'currency_field': 'currency_id'}"/></h2>
											<label string="Ultima cuota"/>
											<h2><field name="ultima_cuota_portal" widget="monetary" options="{'currency_field': 'currency_id'}"/></h2>
											<label string="Neto a cobrar"/>
											<h2><field name="neto_a_pagar" string="Neto a cobrar" widget="monetary" options="{'currency_field': 'currency_id'}"/></h2>
										</group>
										<group string="Costos">
											<field name="currency_id" readonly="1"/>
											<field name="tasa_nominal_anual" string="Tasa Nominal Anual" readonly="1"/>
											<field name="tasa_efectiva_periodo" string="Tasa Efectiva Periodo" readonly="1"/>
											<field name="tasa_efectiva_anual" string="Tasa Efectiva Anual" readonly="1"/>
											<field name="costo_financiero_total_sin_iva" readonly="1"/>
											<field name="costo_financiero_total_con_iva" readonly="1"/>
										</group>
									</group>
									<group col="2" attrs="{'invisible': [('state_portal', '!=', 'condiciones')]}">
										<group col="1" string="Condiciones">
											<div style="margin-left:5px;">
												<field name="aceptacion_detalle_cuotas_portal"/>
												<label string=" Declaro haber leido y aceptado el presente detalle de cuotas."/>
											</div>
											<div style="margin-left:20px;">
												<button name="button_aceptar_detalle_cuotas" class="oe_highlight" 
													string="Aceptar" type="object" style="font-size:10px;"
													attrs="{'invisible': [('aceptacion_detalle_cuotas_portal', '=', True)]}"/>
												<button name="button_ver_detalle_cuotas" class="oe_link" string="Ver detalle cuotas" type="object"/>
											</div>
											<label string="Por favor, necesitamos que leas y aceptes el detalle de cuotas para poder avanzar." 
												style="color:Red;font-size:10px;margin-left:20px;"
												attrs="{'invisible': [('aceptacion_detalle_cuotas_portal', '=', True)]}"/>
											
											<div style="margin-left:5px;">
												<field name="aceptacion_tc_portal"/>
												<label string=" Declaro haber leido y aceptado los presentes terminos y condiciones."/>
											</div>
											<div style="margin-left:20px;">
												<button name="button_aceptacion_tc_portal" class="oe_highlight" 
													string="Aceptar" type="object" style="font-size:10px;"
													attrs="{'invisible': [('aceptacion_tc_portal', '=', True)]}"/>
												<button name="button_ver_tc_portal" class="oe_link" string="Ver terminos y condiciones" type="object"/>
											</div>
											<label string="Por favor, necesitamos que leas y aceptes los terminos y condiciones para poder avanzar." 
												style="color:Red;font-size:10px;margin-left:20px;"
												attrs="{'invisible': [('aceptacion_tc_portal', '=', True)]}"/>
										</group>
										<!-- <group string="Adhesión a Débito Automático">
											<form string="Embedded Webpage" version="7.0" edit="false" create="false"> 
												<center>
													<div style="margin-left:5px;">
														<label string=" Adherí tu tarjeta de Débito para el pago de las cuotas."/>
													</div>
													<iframe src="https://mobbex.com/p/subscriptions/subscribe/XZ27s9cSU/" 
														marginwidth="0" marginheight="0" frameborder="no"
														style="height:660px;width:100%;border-width:0px;">
													</iframe>
												</center>
											</form>
										</group> -->
									</group>
									<footer>
										<button name="button_regresar" class="oe_link" string="Regresar" type="object" attrs="{'invisible': [('state_portal', 'in', ('requisitos', 'aceptacion', 'confirmado'))]}"/>
										<button name="button_simular" class="oe_highlight" string="Siguiente" type="object" attrs="{'invisible': [('state_portal', '!=', 'requisitos')]}"/>
										<button name="button_condiciones" class="oe_highlight" string="Siguiente" type="object" attrs="{'invisible': [('state_portal', '!=', 'simulacion')]}"/>
										<button name="button_aceptar_condiciones" class="oe_highlight" string="Confirmar" type="object" attrs="{'invisible': [('state_portal', '!=', 'condiciones')]}"/>
									</footer>
								</sheet>
            </form>
        </field>
    </record>


    <record model="ir.actions.act_window" id="financiera_prestamo_portal_action">
      <field name="name">Mis prestamos</field>
      <field name="res_model">financiera.prestamo</field>
      <field name="view_mode">tree,form</field>
      <field name="domain">[('state_portal', 'in', ('aceptacion', 'confirmado'))]</field>
      <field name="view_ids" eval="[(5, 0, 0), 
        (0, 0, {'view_mode': 'tree', 'view_id': ref('financiera_prestamo_portal_tree')}), 
        (0, 0, {'view_mode': 'form', 'view_id': ref('financiera_prestamo_portal_form')})]"/>
    </record>

		<!-- Form detalle cuotas portal -->

		<record id="detalle_cuotas_portal" model="ir.ui.view">
			<field name="name">prestamo.detalle.cuotas.portal</field>
			<field name="model">financiera.prestamo</field>
			<field name="arch" type="xml">
				<form string="Prestamo" create="false" edit="true" delete="false">
					<script>
						$(document).ready(function(){
							$('.modal-dialog').css({'width': '97%', 'height': '97%'});
							$('.modal-content').css({'height': '100%'});
							$('.modal-body').css({'height': '100%'});
						});
					</script>
					<field name="cuota_ids">
						<tree create="false" edit="true" delete="false">
							<field name="numero_cuota"/>
							<field name="fecha_vencimiento"/>
							<field name="currency_id" invisible="1"/>
							<field name="saldo_capital" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="capital" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="interes" digits="(16, 2)" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="cuota_pura" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="interes_iva" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="punitorio" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="punitorio_iva" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="seguro" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="seguro_iva" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="ajuste" string="Gestion" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="ajuste_iva" string="IVA gestion" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="debito_automatico_cuota" invisible="1"/>
							<field name="debito_automatico_cuota_cbu" invisible="1"/>
							<field name="debito_bank_id" invisible="1"/>
						</tree>
					</field>
				</form>
			</field>
		</record>
	
		<record model="ir.actions.act_window" id="detalle_cuotas_portal_action">
      <field name="name">Detalle cuotas</field>
      <field name="res_model">financiera.prestamo</field>
      <field name="view_mode">form</field>
      <field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'form', 'view_id': ref('financiera_prestamo_portal_form')})]"/>
    </record>


		<!-- Prestamo inherit agregamos boton envio de sms tc para usuario y agregamos 
		sms como notificacion -->

		<record id="prestamo_portal_form_inherited"  model="ir.ui.view">
			<field name="name">Extension Prestamo Portal Form</field>
			<field name="model">financiera.prestamo</field>
			<field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_form"/>
			<field name="arch" type="xml">
				<xpath expr="//button[@name='button_wizard_seleccionar_plan']" position='after'>
					<field name="state_portal" invisible="1"/>
					<button name="metodo_aceptacion_sms_enviar_tc" string="Enviar aceptacion TC por SMS"
						attrs="{'invisible': ['|', ('state', '!=', 'autorizado'), ('state_portal', '!=', 'aceptacion')]}"
						type="object"/>
				</xpath>
				<xpath expr="//field[@name='email_tc_code_sent']" position='after'>
					<field name="respuesta_email_codigo_prestamo" attrs="{'invisible': [('state_portal', 'not in', ('aceptacion', 'confirmado'))]}"/>
					<field name="respuesta_email_mensaje_original" attrs="{'invisible': [('state_portal', 'not in', ('aceptacion', 'confirmado'))]}"/>
				</xpath>
			</field>
		</record>

    <menuitem name="Mis Prestamos" id="menu_mis_prestamos_portal" 
      web_icon="financiera_app,static/description/icon_mis_prestamos_portal.png" 
      groups="financiera_prestamos.user_portal" action="financiera_prestamo_portal_action"/>

    <!-- <menuitem name="Mis Prestamos" id="menu_mis_prestamos_portal_action" 
      parent="menu_mis_prestamos_portal" action="financiera_prestamo_portal_action" /> -->

		<record model="ir.actions.act_window" id="financiera_prestamo_portal_solicitud_action">
			<field name="name">Solicitar Prestamo</field>
			<field name="res_model">financiera.prestamo</field>
			<field name="view_mode">form</field>
			<field name="view_ids" eval="[(5, 0, 0), 
				(0, 0, {'view_mode': 'form', 'view_id': ref('financiera_prestamo_portal_form')})]"/>
		</record>

		<menuitem name="Solicitar Prestamo" id="menu_prestamo_portal_solicitar" 
			web_icon="financiera_app,static/description/icon_solicitud_portal.png" 
			groups="financiera_prestamos.user_portal" action="financiera_prestamo_portal_solicitud_action"/>


  </data>
</openerp>